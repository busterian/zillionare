![](http://images.jieyu.ai/images/hot/zillionbanner.jpg)

<h1 align="center">大富翁AI量化社区欢迎您!</h1>

<p align="right">
<a href="https://zillionare.readthedocs.io/zh_CN/latest/?badge=latest"><img src="https://readthedocs.org/projects/zillionare/badge/?version=latest"></img></a>
<a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-yellow.svg"></a>
</p>


Zillionare（大富翁）是一个分布式高速量化交易框架。它基于Python 3.8以上版本构建，使用了异步IO和微服务技术，其目标是：

- 分布式高速量化计算平台，算力可根据需要无缝扩展
- 行情数据本地化存储，低延时同步，轻松支持实时触发分钟级别以上交易信号
- 支持私有化部署，保护您的策略
- 虚拟化部署，更易维护
- 诸多量化因子
- 基于机器学习的交易策略
- 基于深度学习的交易策略
- 高速回测框架


# 为什么要开发大富翁？

大富翁作者从2019年起开始关注量化交易。量化交易的基础是必须要有可靠和实时的数据。在试用了一些商业和开源的方案后，我决定自己来写一个框架，主要是要解决如何实时、高效和以可承担的代价获得数据的问题，也有一些品控和技术风格选择上的偏好问题。

一些产品在数据源组织上做的比较好，数据可靠性高，但是不提供离线存储。如果每一笔数据都要在线获取的话，这样会产生两个问题。
    
首先是速度问题。我们的策略常常是要对全市场进行扫描，以最大限度地发现交易信号。但是这种方案会导致大量的数据请求。

我们以一个均线策略为例，假设该策略用到了年线数据，则在对全市场进行扫描的情况下，一次扫描需要从服务器上取得1百万条数据（按A股全市场4000支标的，每支最大取年线250日计算）。

要取得这么多数据，网络请求数量和耗时都是惊人的。以某sdk为例，单会话取100万条数据一般大概需要7-10小时左右。如此一来，就不可能实现任何实时或者准实时的交易策略。即使在一些非实时的场合，比如初次安装完成后的数据库初始化，某开源项目的初始化等待时间以天计（当然支持断点），这也似乎是难以接受的。
    
其次，所有数据都从服务器获取的方案也给服务器带来较大的负荷，因此这样的服务不可能免费提供。比如聚宽是一个非常优秀的数据提供者，使用者可以申请一年期的免费试用权限，试用期间，每天提供100万笔（次）数据。尽管这个方案已经十分慷慨了，但不要说对于实际生产环境，就是自行进行研究也是捉襟见肘。作者自己也常常遇到一轮单元测试没跑完，Quota就不够的情况。

另外一些产品虽然提供了数据本地化存储方案，但不一定解决了上述问题，还可能存在其它限制和缺陷。

比如一些产品把获取数据的API分为离线和在线两类。使用离线API可以就近获取数据，时间和性能上都比较占优，也不占Qutoa，但数据不是实时的，无法用于指导实时交易；如果要得到实时数据仍然必须使用在线API获得数据库里没有的那部分数据，再自行把两种数据拼接起来，这样易用性比较差，也可能引入错误（比如拼接处理错误，复权不对齐错误）。

从技术选型上看，一些产品开发的时间比较早，而Python社区一直在进步，从而这些产品技术上的陈旧和难以维护的问题就日益严重。

如一些产品无论是读本地数据（从数据库中读）还是读远程数据，都在使用同步IO，这对于使用Python作为开发语言的应用来说，这是严重的性能设计缺陷。Python能利用的为数不多的计算资源，往往被消耗在IO等待上了。量化交易框架的使用者往往都要进行二次开发，从个人的角度来看，如非必要，难以接受在这些陈旧的技术框架的基础上继续二次开发，以免将自己的技术锁死在过去的时代。

一些商业项目的品控无法评估，但如果开源项目未使用CI，没有测试覆盖率报告，尽管开源了，也很难评估其品控。

当然，由于个人技术能力和眼界所限，大富翁也肯定存在各种不足。是否达到了作者的预期，也需要用户的评价。

# 大富翁有哪些技术特点？

1. 高性能。为了确保大富翁的高性能，作者从架构、组件选型到算法和数据结构做了较深入的思考，并从产品定位角度上做了取舍。

    大富翁架构在多进程、分布式微服务基础之上，使用了消息队列、负载均衡、缓存（内存）数据库等技术。在行情同步（实时和非实时）时，都使用了多进程协作模式，极大地提高了网络并发量。在进程协作方面，既有负载均衡模式（通过nginx)，也有并行模式(内置消息机制支持）。
    
    在网络组件方面尽可能使用支持异步IO的第三方组件。比如访问Redis数据库时，使用了aioredis；访问数据库时，使用了asyncpg。
    
    在对主要的数据种类--行情数据的深入研究后，根据数据的分布和处理加工特点，决定使用Redis来持久化保存行情数据；使用Numpy的结构化数组来作为行情数据的内存表示--其它框架一般使用的是Pandas。关于为何这样的选择，请参考[[TODO]]。

    另外，我们还从运营的角度不断进行优化。比如初次安装后的数据导入，由于我们使用了CDN加速和多进程模式，在大富翁中导入一年A股的数据（含30分钟及以上K线），只需要170~240秒之间（取决于你的CPU核心数和网络带宽）。如果CPU核数足够多，则导入几年的数据，也大概在15~20分钟以内。这些数据今后还会持续优化，以使得它们在较低配置的电脑上也可以取得较好的速度。关于这一点，使用过其它产品的用户可能有较深的感触。

2. 易用性和品控。在1.0发布之前，大富翁早期最重要的两个组件都经过了多次重写，以确保功能得到恰当解耦和聚合，以保证API的稳定性和易读性。

    如果您有机会深入研究一下大富翁的开发工具链，您会发现品控发生在从代码提交、单元测试到持续集成的各个环。

    为促进大富翁开源社区的活跃，作者发布了一系列文章来介绍Python开发的工具链，请参考[[TODO]]

    在部署方面，我们支持虚拟化部署和pip安装两种模式。虚拟化部署一键全自动，pip安装模式则在安装之后，提供了一个安装向导来引导用户进行配置，整个过程都比较简单。

3. 与社区最新技术保持同步。

    最初Zillionare使用了cookie-cutter的pyproject模板来搭建开发框架。这个模板使用了makefile, pip和requirements文件来管理依赖和构建工程，使用twine来发布；使用tox, pytest等几种lint tools等工具来进行品控，使用sphinx来构建文档。
    
    在依赖管理上，我们发现社区正在往新的标准和工具上迁移。比如完全遵循PEP517的标准的Poetry已经成为了当前社区选择的依赖、构建及版本管理工具。因此，Zillionare在去年11月完全换掉了构建框架。
    
    文档工具也替换成了mkdocs,以反映markdown格式更受作者、读者喜欢的现实。

    此外，我们还加入了Travis CI和Codecov来进行持续集成。使用了pre-commit-hooks来保证签入代码的质量。在1.0发布之前，这个测试覆盖率已经达到了93%。

    今后大富翁将继续坚持这样的技术定位，同时在项目发布上力求更加规范。我们会通过RFC的方式来确定项目的方向，约定API接口，并技术通过测试覆盖来保证接口的可用性。

4. 人工智能导向。尽管大富翁的人工智能功能目前还在实现中，但我们的各项设计充分反映了人工智能优先的导向。比如我们设计中更优先动量策略，对文本和财务数据则关注度不够。原因是，目前人工智能在文本分析上还不是特别有把握，同时依靠消息炒股，确定性也不高。财务数据也有类似的问题。目前人工智能表现最好的，就是在动量策略这一块，所以这也是大富翁的重点。

    对于量化因子，我们不象传统的金融工程那样，把它看成能通过简单组合就能下金蛋的母鸡，而是把更多地把它当成机器学习和深度学习的数据预处理和特征提取工作。这也反映了我们在设计上的人工智能导向。我想这也是一个正确的导向。

5. 完善和详尽的帮助文档。除了这两个特点以外，作者还力求在文档中既讲是什么，更讲为什么，多讲一些技术决定背后的思考，这样读者会更容易理解和变通。

# 大富翁适合哪些用户？

1. 大富翁的定位是为A股市场提供量化交易工具和策略，重点是动量类策略。大富翁目前没有接入期货和数字货币的考虑。
2. 高频套利交易也不是大富翁的关注领域--这个领域更多地的是拼硬件和网速，或者是根本上是拼资本。大富翁定位于服务复杂的A股市场，为A股市场带来开源的人工智能技术。大富翁的架构设计只能处理分钟级别以上的行情数据。我们认为，对Tick级别的数据进行深度学习固然有其意义，但这一领域应该还是套利交易为主。
3. 大富翁提供的历史行情数据从2015年开始，目前包括了所有的股票30分钟及以上的行情数据。
4. 量化交易框架的用户往往都有自己进行二次开发的需求。大富翁的技术选型的先进性和规范性，保证了用户的投入在未来很长一段时间内都能有效.
5. 从技术栈角度来说，大富翁使用纯Python开发。操作系统上限定为Ubuntu > 18。如果对这种操作系统不太熟悉的用户，可以通过我们提供的容器化部署方式来部署。

相对于其它产品而言，大富翁的功能面收得比较紧，我们更希望保持专注，集中精力把事情做好。

# 开发进度
## 1.0版本功能

1. A股行情数据的实时获取及同步任务。
2. 提供从2015年以来的30分钟线及以上K线数据导入。
3. 行情数据的本地化存储及SDK。
4. 财务数据同步、本地化存储及SDK。
5. 数据访问SDK包括以下功能：
    a. 证券列表和交易日历
    b. 时间帧的计算、基于时间帧的触发器（用以根据收盘时间自定义任务，比如触发交易策略）
    c. 行情数据访问：对任何一段行情数据，仅有未同步到本地的数据才会向上游服务器请求，并自动将已闭合的数据在本地缓存，避免再次向上游服务器请求。这个过程对用户完全透明，无须用户参与。
    d. 市值数据访问。

大富翁由一系列子项目组成。更多功能请查看各子项目的帮助文档和版本历史。

## 1.1（规划中）
1. 量化因子
## 1.2 （规划中）
1. 回测框架

## 1.3 （规划中）
1. 基于集成学习模型和量化因子的选股策略
2. 基于CNN的深度学习模型，提供K线形态交易策略

# 大富翁产品矩阵

## Zillionare

统领大富翁各个子项目。Zillionare的一些功能往往是多个组件服务共同完成的，这些组件都有自己的版本编号，我们通过统一发布容器化部署版本的方式，将功能发布以一个完整、单一的视图呈现给用户。

除了容器化部署版本之外，您还可以在这里找到帮助文档和教程。
## Omega

[Omega](https://github.com/zillionare/omega>) 是基于Sanic构建的微服务，它通过行情适配器来收发数据，通过Omicron来将这些数据存储到本地。Omega也是行情同步任务的管理者。

通过前置Nginx，就可以负载均衡的方式提供分布式行情数据服务。此外，Omega还通过消息服务实现多进程之间的任务协作。这些进程可以运行在局域网内的不同的机器上。

[使用文档](https://zillionare-omega.readthedocs.io/zh_CN/latest) [项目地址](https://github.com/zillionare/omega)
## Omicron

[Omicron](https://github.com/zillionare/omicron>) 提供了数据的本地存储读写和其它基础功能，比如交易日历和时间，Triggers，类型定义等。它是zillionare各子项目依赖的数据访问sdk。在您安装了Omega服务器之后，就通过Omicron这个sdk来使用行情数据。

[使用文档](https://zillionare-omicron.readthedocs.io/zh_CN/latest/>) [项目地址](https://github.com/zillionare/omicron)

## jqadaptor

JoinQuant行情数据适配器，是目前大富翁惟一提供的行情数据适配器。

您也可以根据大富翁行情数据适配器的规范，自行编写行情数据适配器。自定义的行情数据适配器，数据来源可以是网络爬虫，也可以是其它数据提供者，比如tushare, baostock等等。

您也可以将自己开发的行情适配器贡献到大富翁开源社区。

## 更多

进一步了解大富翁，请跳转到 [文档](https://zillionare.readthedocs.io/en/latest/) 进一步阅读，谢谢！

## 加入社区

 * QQ群: 142961883
 * 头条号: 解语科技
 * 知乎圈子： Python与量化交易
 * 知乎专栏: 解语科技

<!--
<p align="center">
<img src="http://images.jieyu.ai/images/hot/qq.png" height="72px">
<img src="http://images.jieyu.ai/images/hot/logo-128-transparent.png" height="72px">
<img src="http://images.jieyu.ai/images/hot/quant-logo.jpg" height="72px">
</p>
-->


