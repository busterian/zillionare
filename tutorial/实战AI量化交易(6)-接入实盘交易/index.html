
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.8">
    
    
      
        <title>实战AI量化交易(6) 接入实盘交易 - 大富翁量化社区</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../css/pandas-dataframe.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#官方接口" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="大富翁量化社区" class="md-header-nav__button md-logo" aria-label="大富翁量化社区">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            大富翁量化社区
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              实战AI量化交易(6) 接入实盘交易
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="大富翁量化社区" class="md-nav__button md-logo" aria-label="大富翁量化社区">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    大富翁量化社区
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        简介
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/" class="md-nav__link">
        安装指南
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
      
      <label class="md-nav__link" for="nav-3">
        大富翁量化交易教程
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="大富翁量化交易教程" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          大富翁量化交易教程
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../preface/" class="md-nav__link">
        序言：股价是可以预测的吗
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../chap1/" class="md-nav__link">
        第1章：证券列表、日历和板块
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../developer_guide/" class="md-nav__link">
        大富翁量化框架深度解析
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
      
      <label class="md-nav__link" for="nav-5">
        关于大富翁
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="关于大富翁" data-md-level="1">
        <label class="md-nav__title" for="nav-5">
          <span class="md-nav__icon md-icon"></span>
          关于大富翁
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        授权许可
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../history/" class="md-nav__link">
        版本历史
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../authors/" class="md-nav__link">
        关于开发者
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/zillionare/zillionare/discussions" class="md-nav__link">
        社区
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
      
      <label class="md-nav__link" for="nav-7">
        链接
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="链接" data-md-level="1">
        <label class="md-nav__title" for="nav-7">
          <span class="md-nav__icon md-icon"></span>
          链接
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="https://www.zhihu.com/column/jieyu" class="md-nav__link">
        知乎专栏
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="https://zillionare.readthedocs.io/zh_CN/latest/contributing.htm" class="md-nav__link">
        readthedocs
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#官方接口" class="md-nav__link">
    官方接口
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#利用在线平台接入" class="md-nav__link">
    利用在线平台接入
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#各种模拟客户端的交易方案" class="md-nav__link">
    各种模拟客户端的交易方案
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#基于爬虫的方案" class="md-nav__link">
    基于爬虫的方案
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>实战AI量化交易(6) 接入实盘交易</h1>
                
                <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var scriptElement = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    scriptElement.src = widgetRendererSrc;
    document.body.appendChild(scriptElement);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>我们已经讨论了如何获取相关证券数据（特别是行情数据），如何编写简单的策略（也给出了一个有效的策略，或者说因子），以及如何将数据可视化--这使得我们可以更好地探索新的策略，以及更加直观地解释我们的策略。</p>
<p>我们最终的目标是为了接入市场并从中获利，因此，我们不能永远停留在模拟阶段。现在我们来讨论如何接入实盘交易。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>这一章里我将不会提供面向实际应用的任何代码，其原因是不言而喻的。尽管这种情况可能最终会改变，但截止目前为止，任何第三方接入实盘交易的方式都是不被允许的</strong></p>
<p>在这一章里，我们只讨论那些接入实盘的渠道，以及如果你希望进行一些个人研究的话，哪些技术有可能帮助你。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="官方接口">官方接口<a class="headerlink" href="#官方接口" title="Permanent link">&para;</a></h2>
<p>据行业内的朋友推荐，中泰证券提供有交易接口，被称作XTP。</p>
<p><a href="https://xtp.zts.com.cn/docs/trade/index.html">XTP</a>官方只提供了c++的交易接口实现，但其网页上有推荐的其它语言的实现，比如<a href="https://github.com/ztsec/xtp_api_python">Python实现</a>。</p>
<p>按照相关规定，券商是可以提供支持程序交易的实盘接口的，但是你的代码必须部署在券商提供的机房里。不知道XTP是否也有这种限制，大家可以自己尝试一下。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="利用在线平台接入">利用在线平台接入<a class="headerlink" href="#利用在线平台接入" title="Permanent link">&para;</a></h2>
<p>这里再次推荐聚宽。聚宽提供了免费的在线量化平台，并与第一证券合作，提供了实盘交易。所以你可以直接在聚宽上开发策略并且完成实盘交易。</p>
<p>根据聚宽的说明文档，他们在保证客户<a href="https://www.joinquant.com/help/api/help?name=api#%E5%AE%89%E5%85%A8">策略安全性</a>上下了很多功夫，所以在上面开发策略是完全可以放心的。此外，聚宽量化平台还提供了行情数据、财务数据和计算资源，目前都是免费的。</p>
<h2 id="各种模拟客户端的交易方案">各种模拟客户端的交易方案<a class="headerlink" href="#各种模拟客户端的交易方案" title="Permanent link">&para;</a></h2>
<p>除上述方式外，既然各种证券客户端都可以进行交易，显然，应该可以使用各种模拟客户端、或者类似于键盘精灵类的键鼠驱动程序来实现实盘交易。</p>
<p>这里推荐下<a href="https://easytrader.readthedocs.io/zh/master/">easytrader</a>，在github上有4.4k star，应该是比较成熟的方案了。</p>
<p><img alt="" src="http://images.jieyu.ai/images/2020-10/20201025173108.png" />
<img alt="" src="http://images.jieyu.ai/images/2020-10/20201025173154.png" /></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="基于爬虫的方案">基于爬虫的方案<a class="headerlink" href="#基于爬虫的方案" title="Permanent link">&para;</a></h2>
<p>你可能还想自己实现一个简单、但可控安全的实盘交易方案。如果你的开户券商是东方财富，那么你可以使用爬虫来自行实现交易接口。</p>
<p>下图显示了东方财富提供了网页交易入口：</p>
<p><img alt="" src="http://images.jieyu.ai/images/2020-10/20201025173416.png" /></p>
<p>这个入口地址是：https://jy.xzsec.com/</p>
<p>从入口登录后，就会进入到交易界面：</p>
<p><img alt="" src="http://images.jieyu.ai/images/2020-10/20201025173556.png" /></p>
<p>如果你尝试做一个交易并且提交的话（<em>！请注意这是实盘！</em>），你会发现网页会向服务端发起一个简单的post请求。总共包含以下字段：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>stockCode=600600&amp;price=70.00&amp;amount=100&amp;tradeType=B&amp;zqmc=xxxxxx
</code></pre></div>
</td></tr></table>
<p>这里的zqmc是某种安全机制，它由浏览器中运行的js来生成。因此，使用request库这样的简单爬虫是无法突破这个安全机制的，必须使用selenium这样的模拟客户端，这样可以完全仿真浏览器，运行js代码以完成验证。</p>
<p>我最终推荐的技术方案是pyppeteer。如果你可以进行nodejs开发的话，就使用Puppeteer。selenium是一个成熟的方案，但性能和易用性都不及Pyppeteer。Pyppeteer是nodejs爬虫神器puppeteer的Python移植版。</p>
<p>顺便提句题外话，如果你对破解js感兴趣，可以参考我的这篇文章：<a href="https://zhuanlan.zhihu.com/p/32139007">如何破解js加密算法</a></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>
</code></pre></div>
</td></tr></table>

</div>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="../../assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>