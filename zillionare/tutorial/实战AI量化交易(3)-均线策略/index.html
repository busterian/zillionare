
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="http://www.jieyu.ai/zillionare/tutorial/%E5%AE%9E%E6%88%98AI%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93%283%29-%E5%9D%87%E7%BA%BF%E7%AD%96%E7%95%A5/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.0">
    
    
      
        <title>实战AI量化交易(3) 均线策略 - 解语科技</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.33e2939f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#02a6f2">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../../css/pandas-dataframe.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-27842639-4","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="light-blue" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#均线的计算" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="解语科技" class="md-header__button md-logo" aria-label="解语科技" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            解语科技
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              实战AI量化交易(3) 均线策略
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/zillionare/zillionare/" title="前往 GitHub 仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    zillionare
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      欢迎
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../preface/" class="md-tabs__link md-tabs__link--active">
        大富翁
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../blog/best_practice_python/" class="md-tabs__link">
        博客
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../products/" class="md-tabs__link">
        产品和下载
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="https://www.zhihu.com/column/jieyu" class="md-tabs__link">
      知乎专栏
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="解语科技" class="md-nav__button md-logo" aria-label="解语科技" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    解语科技
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/zillionare/zillionare/" title="前往 GitHub 仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    zillionare
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        欢迎
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        大富翁
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="大富翁" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          大富翁
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" checked>
      
      <label class="md-nav__link" for="__nav_2_1">
        量化交易教程
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="量化交易教程" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          量化交易教程
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../preface/" class="md-nav__link">
        序
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../chap1/" class="md-nav__link">
        1 证券列表、板块和K线数据
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../chap2/" class="md-nav__link">
        2 可视化
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      <label class="md-nav__link" for="__nav_2_2">
        大富翁框架
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="大富翁框架" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          大富翁框架
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../diveintozillionare/" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../diveintozillionare/developer_guide/" class="md-nav__link">
        大富翁产品矩阵
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../diveintozillionare/lint%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        Lint工具
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../diveintozillionare/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" class="md-nav__link">
        单元测试
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../diveintozillionare/%E6%96%87%E6%A1%A3%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        文档工具
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../diveintozillionare/%E6%9E%84%E5%BB%BA%E5%92%8C%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86/" class="md-nav__link">
        构建和依赖管理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../diveintozillionare/%E9%83%A8%E7%BD%B2zilliionare/" class="md-nav__link">
        如何使用zillionare docker images
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        博客
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="博客" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          博客
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      <label class="md-nav__link" for="__nav_3_1">
        Python工程最佳实践
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Python工程最佳实践" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Python工程最佳实践
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/best_practice_python/" class="md-nav__link">
        大纲
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/best_practice_python/chap1/" class="md-nav__link">
        开发环境和工具
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/best_practice_python/chap2/" class="md-nav__link">
        构建Python虚拟运行时环境
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/best_practice_python/chap3/" class="md-nav__link">
        工程布局与向导工具
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        产品和下载
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="产品和下载" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          产品和下载
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../products/" class="md-nav__link">
        大富翁
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://www.zhihu.com/column/jieyu" class="md-nav__link">
        知乎专栏
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#均线的计算" class="md-nav__link">
    均线的计算
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#求直线的斜率" class="md-nav__link">
    求直线的斜率
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#均线策略1---均线多头排列" class="md-nav__link">
    均线策略1 - 均线多头排列
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#均线策略---月线回踩" class="md-nav__link">
    均线策略 - 月线回踩
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#结束语" class="md-nav__link">
    结束语
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/zillionare/zillionare/edit/master/docs/zillionare/tutorial/实战AI量化交易(3)-均线策略.ipynb" title="编辑此页" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>实战AI量化交易(3) 均线策略</h1>
                
                <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var scriptElement = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    scriptElement.src = widgetRendererSrc;
    document.body.appendChild(scriptElement);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">jqdatasdk</span> <span class="k">as</span> <span class="nn">jq</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># 请在环境变量中设置聚宽账号。账号可在jointquant.com上免费申请</span>
<span class="n">account</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;JQ_ACCOUNT&#39;</span><span class="p">)</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;JQ_PASSWORD&#39;</span><span class="p">)</span>

<span class="n">account</span><span class="o">=</span><span class="s1">&#39;18694978299&#39;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;87Ai2y3LzPOe&#39;</span>

<span class="n">jq</span><span class="o">.</span><span class="n">auth</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>提示：当前环境 pandas 版本高于 0.25，get_price 与 get_fundamentals_continuously 接口 panel 参数将固定为 False
注意：0.25 以上版本 pandas 不支持 panel，如使用该数据结构和相关函数请注意修改
auth success 
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>经过前面两章的学习，你现在已经基本拥有了一个常规股票软件所具有的能力！从这一章起，我们通过一些例子来看看如何解锁这些能力。这一章我们将考察一些均线战法的例子。</p>
<h2 id="均线的计算">均线的计算<a class="headerlink" href="#均线的计算" title="Permanent link">&para;</a></h2>
<p>均线的作用是用来平滑股价的波动。一个充满了太多突变和断点的系统是无法分析的。在上一章里我们讲到计算分时均线的两种方法：</p>
<ul>
<li>
<p>对个股，我们使用了其到当前时刻的累积成交额、除于其到当前时刻的累积成交量，这样就得到了从开盘以来，到当前时刻的平均成交价。</p>
<p><em>np.cumsum(money)/np.cumsum(volume)</em></p>
<p>这里money、volume都是np.array数组（通过get_bars获得），对它们进行np.cumsum之后，仍然是一个np.array数组；此外两个同维度的np.array数组进行四则运算，得到的结果仍然是与输入相同维度的np.array数组。这是numpy运算的广播特性。当我们运用这个特性来进行大规模的数学运算时，可以得到很好的性能。</p>
</li>
<li>
<p>对指数，由于指数编制方法不同，上数方法不能奏效。因此我们使用了从开盘以来，直到现在所有价格的平均值。这也是同花顺分时均价线的一个算法。
   <em>np.cumsum(close)/np.count_nonzero(close &gt; 0)</em></p>
</li>
</ul>
<p>这里close是每分钟收盘价，仍然是一个numpy数组。np.cumsum(close)是求从开盘以来，到每一个元素所在的位置的收盘价的累加。np.count_nonzero(close &gt; 0)实际上是要计算对应被累加的收盘价个数。</p>
<p>在K线图中，我们使用另一种方式来计算均线，即使用移动平均(moving average,简称ma)。与上述方法中，总是使用从开盘以来、到当前为止的所有收盘价代入计算不同，我们在计算ma值时，只使用滑动窗口以内的那些收盘价，因为过早的数据，可能对当下并没有太多意义。</p>
<p>我们仍然使用numpy来计算ma的值。注意，在上一章我们通过get_bars来获取行情数据时，我们推荐改写参数df=False，以返回numpy structured array数据结构的数据。反之，返回的行情数据是pandas.DataFrame的。</p>
<p>这里我们要接触一个科学函数，convolve，即卷积。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">moving_average</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">win</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">win</span><span class="p">)</span><span class="o">/</span><span class="n">win</span><span class="p">,</span> <span class="s1">&#39;valid&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>这里我们使用了长度为win，每个元素为1/win的卷积核。当我们有其它信号平滑处理要求时，我们可能使用别的卷积核，比如高斯核：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>gaussian_kernel_3 = np.array([0.25, 0.5, 0.25])
gaussian_kernel_5 = np.array([0.0625, 0.25, 0.375, 0.25, 0.0625])
gaussian_kernel_7 = np.array([0.03125, 0.109375, 0.21875, 0.28125, 0.21875, 0.109375, 0.03125])
</code></pre></div>
</td></tr></table>
<p>现在我们来尝试求一个日线的ma5:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">shbars</span> <span class="o">=</span> <span class="n">jq</span><span class="o">.</span><span class="n">get_bars</span><span class="p">(</span><span class="s1">&#39;000001.XSHG&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;1d&#39;</span><span class="p">,</span> <span class="n">include_now</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ma5</span> <span class="o">=</span> <span class="n">moving_average</span><span class="p">(</span><span class="n">shbars</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ma5</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ma5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3280</span><span class="p">,</span> <span class="s1">&#39;000001 2020/10/14&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>[3242.83 3232.84 3220.51 3230.29 3258.1  3286.54 3309.83]
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>Text(0, 3280, &#39;000001 2020/10/14&#39;)</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>与行情软件对照，结果一模一样。使用np.convovle的优势在于其速度。假设我们现在要对全市场所有的股票求日线的ma5，这需要多少时间呢？有人曾经使用过talib,因为需要进行循环，所以最后需要好几分钟才能算出来。我们来试一下：</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># 模拟4000支股票的收盘价数据</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">4000</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">shbars</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">],</span><span class="n">n</span><span class="p">)</span>

<span class="c1"># 现在我们得到一个 4000*11的二维数组</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)))</span>

<span class="c1"># 使用np.convole来计算，它只能处理一维数组</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;valid&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>147 µs ± 3.23 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each)
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>上面的代码中由于我们只关心计算速度，所以我们通过repeat，把已拿到的上证指数的收盘价重复了4000遍，这相当于获取了全市场的收盘价。然后我们直接对这个新的数组（一个有44000维的巨大数组）求移动均值，结果发现，只共只需要89us（使用的2015年的curo i7)。</p>
<p>当然，上面的代码只是为了演示如何进行性能优化，这样计算出来的结果，还必须进行后处理才能使用，因为它把前后相连的两支股票会放在一起计算均值。这里我们使用性能上略慢一点的scipy中的函数：</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># 使用scipy来计算</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
<span class="n">ma5</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">convolve2d</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;valid&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ma5</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">signal</span><span class="o">.</span><span class="n">convolve2d</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;valid&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>[3242.83 3232.84 3220.51 3230.29 3258.1  3286.54 3309.83]
645 µs ± 38.7 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>将结果进行对照，计算完全正确。对4000支股票计算5日均线值，只花了645us。</p>
<p><strong>在代码中我们注意了性能优化，这样就带来了一定的阅读难度，但为了贴近实战，后面大家会发现，实战中对性能要求还是很高的</strong></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="求直线的斜率">求直线的斜率<a class="headerlink" href="#求直线的斜率" title="Permanent link">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>如果你用过通达信软件的公式，就知道它提供了一个名为slope的函数。不过因为帮助文档不够清楚的关系，我一直不知道这个函数应该怎么用。比如，看上去是斜率公式，那它的单位是什么？倾角？还是一次性系数？</p>
<p>但是，相关的概率在短线中还是很有用的。比如，如果一支大涨后的股票进入盘整阶段，当前已接近某均线；此时是否可以买入呢？如果均线有较好的支撑作用，很可能该股马上转入主升；如果均线支撑力度不强，则有可能还会继续下跌。</p>
<p>判断均线支撑力度强弱的标准是什么？这里我们给一个斜率因子。如果均线的斜率越大，则支撑越强。</p>
<p>如果均线在K线图上显示为一条近似直线的话，那么就可以使用一次项拟合来求得其斜率。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">rmse</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    返回预测序列相对于真值序列的标准差。</span>
<span class="sd">    Args:</span>
<span class="sd">        y:</span>
<span class="sd">        y_hat:</span>

<span class="sd">    Returns:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_hat</span><span class="p">)))</span>

<span class="k">def</span> <span class="nf">slope</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">err</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;返回直线斜率和倾角。如果拟合误差大于err，则抛出异常</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 对ts进行归一化，以便斜率可以在不同的时间序列之间进行比较</span>
    <span class="k">assert</span> <span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span> <span class="o">/</span> <span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="n">ts_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">ts_hat</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">ts</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">error</span> <span class="o">&gt;=</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;can not fit into line&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># 现在看看今天（2020年10月14日，上证指最近5天MA的斜率</span>
<span class="n">ma5</span> <span class="o">=</span> <span class="n">moving_average</span><span class="p">(</span><span class="n">shbars</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">slope</span><span class="p">(</span><span class="n">ma5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>0.73%
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>得到的斜率是0.73%。这里的斜率意味着每过1天，大盘MA5上涨0.73%，也就是20多个点。这也说明大盘最近相当强势，在过去一年里，有多少天是这样的呢？留给大家作为习题吧，评论区给解答。
当然，如果斜率函数能给出均线与横轴的夹角，那就更直观了。然而，这里有一个误区。均线与横轴的夹角，不光取决于均线走势本身，还取决于我们如何绘制均线。在后面的深度学习章节里，我们会把这些数据图形化，再通过CNN网络来学习，那时候我们再详细讨论这种误区。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="均线策略1---均线多头排列">均线策略1 - 均线多头排列<a class="headerlink" href="#均线策略1---均线多头排列" title="Permanent link">&para;</a></h2>
<p>假设我们要找出近期刚出现均线多头的股。为了便于演示，我们就找5，10，20均线多头的好了。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">find_runs</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find runs of consecutive items in an array.&quot;&quot;&quot;</span>

    <span class="c1"># ensure array</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;only 1D array supported&#39;</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># handle empty array</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># find run starts</span>
        <span class="n">loc_run_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">loc_run_start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">out</span><span class="o">=</span><span class="n">loc_run_start</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">run_starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">loc_run_start</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># find run values</span>
        <span class="n">run_values</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">loc_run_start</span><span class="p">]</span>

        <span class="c1"># find run lengths</span>
        <span class="n">run_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run_starts</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">run_values</span><span class="p">,</span> <span class="n">run_starts</span><span class="p">,</span> <span class="n">run_lengths</span>

<span class="k">def</span> <span class="nf">is_long_parallel</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param ts: 收盘价数组</span>
<span class="sd">    :params n: 多头排列刚形成n天</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ma5</span> <span class="o">=</span> <span class="n">moving_average</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ma10</span> <span class="o">=</span> <span class="n">moving_average</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">ma20</span> <span class="o">=</span> <span class="n">moving_average</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

    <span class="c1"># 注意各均线序列的长度并不一样</span>
    <span class="n">ma5</span> <span class="o">=</span> <span class="n">ma5</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
    <span class="n">ma10</span> <span class="o">=</span> <span class="n">ma10</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
    <span class="n">ma20</span> <span class="o">=</span> <span class="n">ma20</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>

    <span class="n">signal</span> <span class="o">=</span> <span class="p">(</span><span class="n">ma5</span><span class="o">&gt;</span><span class="n">ma10</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">ma10</span><span class="o">&gt;</span><span class="n">ma20</span><span class="p">)</span>

    <span class="n">run_values</span><span class="p">,</span> <span class="n">run_starts</span><span class="p">,</span> <span class="n">run_lengths</span> <span class="o">=</span> <span class="n">find_runs</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>

    <span class="c1"># 最后一段必须为多头排列，且长度为要求的n</span>
    <span class="k">return</span> <span class="n">run_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">run_lengths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">n</span>

<span class="c1"># 我们以上证2020年6月24为例，看是否形成了均线多头（且刚形成两天）</span>
<span class="n">bars</span> <span class="o">=</span> <span class="n">jq</span><span class="o">.</span><span class="n">get_bars</span><span class="p">(</span><span class="s1">&#39;000001.XSHG&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;1d&#39;</span><span class="p">,</span> <span class="n">end_dt</span><span class="o">=</span><span class="s1">&#39;2020-6-24&#39;</span><span class="p">,</span><span class="n">include_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">bars</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span>

<span class="n">is_long_parallel</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>True</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>大家知道，A股在6月底、7月初形成一股主升浪。如果我们早就知道这个方法，并且始终在用程序监控的话，是否也能抓住今年这最大的一波行情呢？</p>
<h2 id="均线策略---月线回踩">均线策略 - 月线回踩<a class="headerlink" href="#均线策略---月线回踩" title="Permanent link">&para;</a></h2>
<p><img alt="" src="http://images.jieyu.ai/images/2020-10/20201014202805.png" /></p>
<p>我们看到月均线呈直线上升之势，而且在7月、8月、9月都回踩过均线。如果在回踩均线时介入，真是进可攻、退可守的好棋。现在，我们就使用均线多头加斜率参数来找出这种股。</p>
<p>上面图形中的这只个股，它的月线斜率是0.069，也就是月线的ma5每个月上涨6.9%，这是一个相当好的涨幅，因为这是均线的上涨，实际股价的上涨要比这个高一些，但也还没有到最后的主升浪的疯狂期。在下面的函数中，我们将月线斜率设置为0.04，以便筛选出处在上涨早期的个股。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">securities</span> <span class="o">=</span> <span class="n">jq</span><span class="o">.</span><span class="n">get_all_securities</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">find_adv_maline</span><span class="p">(</span><span class="n">end</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">slp</span><span class="o">=</span><span class="mf">0.04</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">arrow</span>
    <span class="n">_end</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">securities</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">securities</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">code</span><span class="p">][</span><span class="s1">&#39;end_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">&lt;</span><span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">():</span>
            <span class="k">continue</span>

        <span class="n">bars</span> <span class="o">=</span> <span class="n">jq</span><span class="o">.</span><span class="n">get_bars</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;1M&#39;</span><span class="p">,</span> <span class="n">end_dt</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">include_now</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fq_ref_date</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bars</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">all_up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">bars</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="o">&gt;</span><span class="n">bars</span><span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span>
        <span class="n">ma</span> <span class="o">=</span> <span class="n">moving_average</span><span class="p">(</span><span class="n">bars</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">],</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">slope</span><span class="p">(</span><span class="n">ma</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">slp</span> <span class="ow">and</span> <span class="n">all_up</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">securities</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">code</span><span class="p">][</span><span class="s1">&#39;display_name&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="n">find_adv_maline</span><span class="p">(</span><span class="s1">&#39;2020-10-1&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>共产生了110个左右的信号，我在这里选取了16个：
<img alt="" src="http://images.jieyu.ai/images/2020-10/20201014214244.png" />
16朵妖艳的玫瑰。我爱她们。她们有的含羞待放，有的艳不可挡，有的丰韵犹存，在大盘的呵护下，或许还能摇曳生姿直到这个深秋。</p>
<p>这些股票最好的买入点，是等它回到5月均线的那一天。也许你没有耐心每天对着100多支股票去检查有没有到5月均线，没关系，我们即将推出一个智能监控工具，现在提供首批25名免费名额。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="结束语">结束语<a class="headerlink" href="#结束语" title="Permanent link">&para;</a></h2>
<p>好了。这一章的主要内容就到这里。你或许已经注意到，我们没有提及任何经典的指标，比如macd,kdj,rsi,bolling band,wm等等。那是因为，这些指标属于历史，也不属于这里的股市。在序言那一章里，我们已或多或少谈起过这个话题。但是，如果你特别好奇的话，你可以使用talib库。这是一个c++的库，有python的接口，它提供了几乎所有经典指标的计算。</p>
<p>即使只以我们现在介绍的内容，就足以发现打开财富大门的钥匙，如果你对照本文反复练习，你会相信这一点。当然，这里还存在一些交易技巧和看盘技巧没有讲，需要你自己去琢磨。随着我们进入到机器学习和深度学习的部分，你会掌握更加高级、丰富和稳健的策略，或者说没有固定的策略，机器生成一切。</p>
<p>为了第一时间得到这些文章，请关注本号。本教程的目录在底部菜单的 <strong>AI量化交易</strong> 菜单栏下。</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>
</code></pre></div>
</td></tr></table>

</div>
</div>
                
              
              
                


  <h2 id="__comments">评论</h2>
  <div id="disqus_thread"></div>
  <script>var disqus_config=function(){this.page.url="http://www.jieyu.ai/zillionare/tutorial/%E5%AE%9E%E6%88%98AI%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93%283%29-%E5%9D%87%E7%BA%BF%E7%AD%96%E7%95%A5/",this.page.identifier="/zillionare/tutorial/%E5%AE%9E%E6%88%98AI%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93%283%29-%E5%9D%87%E7%BA%BF%E7%AD%96%E7%95%A5/"};window.addEventListener("load",function(){var e=document,i=e.createElement("script");i.src="//jieyu.disqus.com/embed.js",i.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(i)})</script>

              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../preface/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              序
            </div>
          </div>
        </a>
      
      
        <a href="../%E5%AE%9E%E6%88%98AI%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93%284%29-%E5%8A%A8%E9%87%8F%E7%AD%96%E7%95%A5/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              实战AI量化交易(4) 动量策略
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
      <a href="https://www.zhihu.com/club/1243142164264886272" target="_blank" rel="noopener" title="知乎圈子" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13H170.54zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82v170.31zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7.91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62v.01zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2l19.23 14.43zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78l.03-.01z"/></svg>
      </a>
    
      
      
      <a href="https://qm.qq.com/cgi-bin/qm/qr?k=kErrI22lCmhKXN8we_iY7jS2sBPnXk8_&jump_from=webapi" target="_blank" rel="noopener" title="量化交易群" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z"/></svg>
      </a>
    
      
      
      <a href="https://github.com/zillionare" target="_blank" rel="noopener" title="Github" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
      <a href="mailto:code@jieyu.ai" target="_blank" rel="noopener" title="" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.indexes", "navigation.tabs", "navigation.instant", "navigation.tabs.sticky"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.d892486b.min.js"></script>
      
    
  </body>
</html>